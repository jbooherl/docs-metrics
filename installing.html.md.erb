---
breadcrumb: App Metrics Documentation
title: Install App Metrics
owner: App Metrics
list_style_none: true
---

<strong><%= modified_date %></strong>
 Before you begin your installation of App Metrics there are certain prerequisites you need to know.

Here are your prerequisites to install App Metrics:

<p class="note"><b>Note:</b> App Metrics v2.0 requires <a href="https://docs.vmware.com/en/Metric-Store/index.html" target="_blank">Metric Store</a> as its metrics datastore. You will need to install this tile before installing App Metrics.</p>

+ **If upgrading from the Metrics v1.x line:**
The App Metrics tile will install as a seperate tile and will not install over the v1.x version of the Metrics tile.
There is no data migration from the v1.x line to the v2.x line of the product.
To maintain historical data please install both tiles  side-by-side for two weeks before uninstalling the Metrics v1.x line.
    <p class="note"><strong>Note:</strong> App Metrics will take over the `metrics.YOUR-SYSTEM-DOMAIN`.
        Please turn off the `Push PCF Metrics Components Errand` for the Metrics v1.x tile to avoid install errors.
        Metrics v1.x will be accessible at `metrics-previous.YOUR-SYSTEM-DOMAIN`.
    </p>

## <a id='AddTile'></a>Downloading App Metrics

<ol>
<li>After you have installed the <a href="https://docs.vmware.com/en/Metric-Store/index.html" target="_blank">Metric Store</a> tile in Ops Manager,
    download the App Metrics 2.0 product file from <a href="https://network.tanzu.vmware.com/products/apm/releases" target="_blank">VMware Tanzu Network</a>.</li>
<li>Go to the Ops Manager Installation Dashboard and click Import a Product to upload the product file.</li>
<li>Under the Import a Product button, click + next to the version number of App Metrics. This adds the tile to your staging area.</li>
</ol>

## <a id='ConfigureAzs'></a>Configuring availability zones and networks

To start using App Metrics, you need to configure the App Metrics tile by performing the following steps:
<ol>
<li>Click the App Metrics tile on the Ops Manager Installation Dashboard.</li>
<li>Navigate to Assign AZs and Networks and do the following:</li>
<ul>
<li>Select an Availability Zone (AZ) for placing singleton jobs.</li>
<li>Select one or more AZs for balancing other jobs. (Note: To create a highly available environment,
VMware recommends selecting multiple AZs.)</li>
<li>Select Network for installing App Metrics.</li>
</ul>
</ol>

## <a id='ConfigureProxy'></a>Configuring App Metrics to use HTTP or SOCKS proxy server (Optional)

You can configure App Metrics to use your HTTP, HTTPS, or SOCKS proxy server for
Slack or webhook alerts.

### <a id='EnableHTTP'></a>Enabling an HTTP or HTTPS Proxy Server
Enable a HTTP or HTTPS Proxy Server through the cf CLI.

1. Log in to the cf CLI by running:

    ```
    cf login -a API-URL -u USERNAME -p PASSWORD -o system -s app-metrics-v2
    ```
    Where:
    * `API-URL` is your API endpoint.
    * `USERNAME` is your username.
    * `PASSWORD` is your password.

1. Update the `HTTP_PROXY` or `HTTPS_PROXY` environment variable by running:

    ```
    cf set-env appmetrics HTTP_PROXY "http://PROXY-HOST:PROXY-PORT"
    ```

    or

    ```
    cf set-env appmetrics HTTPS_PROXY "https://PROXY-HOST:PROXY-PORT"
    ```

    Where:
    * `PROXY-HOST` is the hostname of your HTTP or HTTPS proxy.
    * `PROXY-PORT` is the port that your HTTP or HTTPS proxy is listening on.

    The HTTP proxy environment variables must be uppercase. For more information
    on setting system-wide environment variables, see [Environment Variable Groups]
    (https://docs.cloudfoundry.org/devguide/deploy-apps/environment-variable.html#evgroups)
    in the Cloud Foundry Documentation.

### <a id='EnableSOCKS'></a>Starting a SOCKS proxy server

  1. Click the App Metrics tile on the Ops Manager Installation Dashboard.
  1. Navigate to the **App Metrics Components Config** pane.
  1. Click **Enable Socks Proxy**. This checkbox sets the `USE_SOCKS_PROXY`
  environment variable, which overrides the protocol for the proxy to use SOCKS instead of HTTP or HTTPS.

  1. Even though the HTTP or HTTPS proxy will be overriden, you must set it first. To do so, log in to the cf CLI by running:

      ```
      cf login -a API-URL -u USERNAME -p PASSWORD -o system -s app-metrics-v2
      ```
      Where:
      * `API-URL` is your API endpoint.
      * `USERNAME` is your username.
      * `PASSWORD` is your password.

  1. Update the `HTTP_PROXY` or `HTTPS_PROXY` environment variable:

      ```
      cf set-env appmetrics HTTP_PROXY "http://PROXY-HOST:PROXY-PORT"
      ```

      or

      ```
      cf set-env appmetrics HTTPS_PROXY "https://PROXY-HOST:PROXY-PORT"
      ```

      Where:
      * `PROXY-HOST` is the hostname of your HTTP or HTTPS proxy.
      * `PROXY-PORT` is the port that your HTTP or HTTPS proxy is listening on.

    The HTTP proxy environment variables must be uppercase. For more information
    on setting system-wide environment variables, see [Environment Variable Groups]
    (https://docs.cloudfoundry.org/devguide/deploy-apps/environment-variable.html#evgroups)
    in the Cloud Foundry Documentation.

## <a id='ConfigureFeatures'></a>Configuring App Metrics components (Optional)

Here you can configure the settings for App Metrics components, including Log Store.
<ol>
<li>Click the App Metrics tile on the Ops Manager Installation Dashboard.</li>
<li>Go to the App Metrics Components Config pane.</li>
<li>To deactivate the Logs Drawer on the App Metrics dashboard, deselect the <strong>App Metrics Enable Logs</strong> check box. This is enabled by default.</li>
<li>Set the App Metrics Logs Prune Threshold disk capacity percentage. This set to 80% by default. This is the disk percentage at which Log Store starts to prune the oldest logs first.</li>
<li>Set the App Metrics Logs Prune Interval. This set to two minutes by default. This is the frequency at which Log Store checks the disk capacity to make the pruning decision.</li>
</ol>

## <a id='ConfigureSyslog'> </a> Configuring syslog forwarding (Optional)

App Metrics supports forwarding syslog to an external log management service. For example Papertrail, Inc., Splunk Technology, or another custom enterprise log sink. You might find the VM logs useful for debugging problems in the system.

To enable remote syslog forwarding for Healthwatch:

1. Click **App Metrics** tile on the Ops Manager Installation Dashboard.

2. Go to the **Syslog** pane.

3. Select **Yes without encryption** or **Yes with TLS encryption** to activate syslog forwarding.

   * **External Syslog Host**: address of syslog server where you want logs sent. For example, [logs.example.com].
   * **External Syslog Port**: port of your syslog server. For example, [29279].
   * **External Syslog Protocol**: protocol for sending the logs.
   * **External Syslog Permitted Peer**: enter the fingerprint or name of the remote peer. For example, [*.example.com]. (TLS only).
   * **External Syslog TLS CA Certificate**: enter the CA certificate of the syslog destination.(TLS only).

## <a id='ConfigureMetricRegistrar'></a>Configuring Metric Registrar for Spring Boot Metrics (Optional)

For Metric Registrar to accurately report Spring Metrics, the configuration for Metric Registrar must be updated with the VMware Tanzu Application Service for VMs (TAS for VMs) tile.

To update the Metric Registrar configuration:

To enable remote syslog forwarding for Healthwatch, do the following:
<ol>
<li>Click the App Metrics tile on the Ops Manager Installation Dashboard.</li>
<li>Navigate to the Syslog pane.</li>
<li>Select Yes without encryption or Yes with TLS encryption to enable syslog forwarding.</li>
<li>For External Syslog Host, enter the address of syslog server where you want logs sent, such as [logs.example.com].</li>
<li>For External Syslog Port, enter the port of your syslog server, such as [29279].</li>
<li>For External Syslog Protocol, select the protocol for sending the logs.</li>
<li>(TLS only) For External Syslog Permitted Peer, enter the fingerprint or name of the remote peer, such as [*.example.com].</li>
<li>(TLS only) For External Syslog TLS CA Certificate, enter the CA certificate of the syslog destination.</li>
</ol>

## <a id='AppManagerLinkConfig'></a> Activating the App Metrics link in Apps Manager (Optional)

In order for Metric Registrar to accurately report Spring Metrics, the configuration for Metric Registrar must be updated in the VMware Tanzu Application Service for VMs (TAS for VMs) or Pivotal Application Service (PAS) tile.

To update the Metric Registrar configuration, do the following:
<ol>
<li>Click the TAS for VMs or PAS tile on the Ops Manager Installation Dashboard.</li>
<li>Navigate to the Metric Registrar pane.</li>
<li>Update the Blocked tags list and remove the `id` tag from the list of Blocked tags.</li>
</ol>

## <a id='AppManagerLinkConfig'></a> (Optional) Enable the App Metrics Link in Apps Manager

Perform this step if the **View in App Metrics** does not appear in Apps Manager and App Metrics is deployed with one the following versions of TAS for VM or PAS:

- TAS for VMs v2.10.x
- TAS for VMs v2.9.x
- PAS v2.8.4 or later
- PAS v2.7.10 or later
- PAS v2.6.16 or later

The **View in App Metrics** link may not appear in Apps Manager if your <%= vars.app_runtime_abbr %> deployment has restrictive networking policies around request proxying.

To resolve this issue and enable the App Metrics link in Apps Manager:

1. Log in to the cf CLI by running:

    ```
    cf login -a API-URL -u USERNAME -p PASSWORD -o system -s system
    ```
    Where:
    * `API-URL` is your API endpoint.
    * `USERNAME` is your username.
    * `PASSWORD` is your password.

1. Update the `no_proxy` environment variable for the `search-server` app to include your system domain.

    ```
    cf set-env search-server no_proxy '*.SYSTEM-DOMAIN'
    ```
    where `SYSTEM-DOMAIN` is the system domain configured for your <%= vars.app_runtime_abbr %> deployment.
    For example:
    <pre class="terminal">
    cf set-env search-server no_proxy '*.example.com'
    </pre>

1. Restage the `search-server` app.

    ```
    cf restage search-server
    ```
