---
breadcrumb: App Metrics Documentation
title: Installing App Metrics
owner: App Metrics
list_style_none: true
---

<strong><%= modified_date %></strong>

## <a id='prerequisites'></a>Prerequisites

Before you install App Metrics:

<p class="note"><b>Note:</b> App Metrics v2.1 requires <a href="https://docs.pivotal.io/metric-store" target="_blank">Metric Store</a> as the metrics datastore. You must install this tile before you install App Metrics.</p>

If you upgrade from the Metrics v1.x :
The App Metrics tile is installed as a separate tile and does not install over the v1.x version of the Metrics tile.

There is no data migration from v1.x to v2.x of the product.
To maintain historical data you must install both version tiles side-by-side for two weeks before uninstalling Metrics v1.x.

<p class="note"><strong>Note:</strong> App Metrics takes over the `metrics.YOUR-SYSTEM-DOMAIN`.

Turn off `Push PCF Metrics Components Errand` for the Metrics v1.x tile to avoid installation errors.

Metrics v1.x is accessible at `metrics-previous.YOUR-SYSTEM-DOMAIN`.
</p>

## <a id='AddTile'></a>Download App Metrics

<ol>
<li>After you install the <a href="https://docs.pivotal.io/metric-store" target="_blank">Metric Store</a> tile in Ops Manager,
    download the App Metrics 2.1 product file from <a href="https://network.pivotal.io/products/apm" target="_blank">VMware Tanzu Network</a>.</li>
<li>Go to the Ops Manager Installation Dashboard and click <strong>Import a Product</strong> to upload the product file.</li>
<li>Click the plus sign (+) next to the version number of App Metrics to add the tile to your staging area.</li>
</ol>

## <a id='ConfigureAzs'></a>Configure AZs and Networks

To start using App Metrics, you must configure the App Metrics tile by performing the following steps:
<ol>
<li>Click the <strong>App Metrics</strong> tile on the Ops Manager Installation Dashboard.</li>
<li>Go to <strong>Assign AZs and Networks</strong> and do the following:</li>
<ul>
<li>Select an Availability Zone (AZ) for placing singleton jobs.</li>
<li>Select one or more AZs for balancing other jobs.

<p> To create a highly available environment, select multiple AZs and then select Network for installing App Metrics.</p>
</ul>
</ol>

## <a id='ConfigureProxy'></a>Configure App Metrics to Use an HTTP or SOCKS Proxy (Optional)

You can configure App Metrics to use your HTTP, HTTPS, or SOCKS proxy server for
Slack or webhook alerts.

To configure a HTTP or HTTPS Proxy Server through the cf CLI, follow these steps:

1. Log in to cf CLI and run:

    ```
    cf login -a API-URL -u USERNAME -p PASSWORD -o system -s app-metrics-v2
    ```

    Where:

    + `API-URL` is your API endpoint.
    + `USERNAME` is your username.
    + `PASSWORD` is your password.

2. Update the `HTTP_PROXY` or `HTTPS_PROXY` environment variable. Run:

    ```
    cf set-env appmetrics HTTP_PROXY "http://PROXY-HOST:PROXY-PORT"
    ```

    or

    ```
    cf set-env appmetrics HTTPS_PROXY "https://PROXY-HOST:PROXY-PORT"
    ```

    Where:

    + `PROXY-HOST` is the hostname of your HTTP or HTTPS proxy.
    + `PROXY-PORT` is the port that your HTTP or HTTPS proxy is listening on.

    The HTTP proxy environment variables must be uppercase.

    For more information
    on setting system-wide environment variables, see [Environment Variable Groups](https://docs.cloudfoundry.org/devguide/deploy-apps/environment-variable.html#evgroups),
    in the Cloud Foundry Documentation.

### <a id='EnableSOCKS'></a>Enable a SOCKS Proxy Server

To start a HTTP or HTTPS proxy use the cf CLI, then switch to a SOCKS protocol in the Ops Manager UI and follow these steps:

  1. Click the **App Metrics** tile on the Ops Manager Installation Dashboard.
  1. Go to **App Metrics Components Config** pane.
  1. Click **Enable Socks Proxy**. This check box sets the `USE_SOCKS_PROXY`
  environment variable, which overrides the protocol for the proxy to use SOCKS instead of HTTP or HTTPS.

  1. Even though the HTTP or HTTPS proxy is overrode, you must begin by setting it. To set it, log in to the cf CLI and run:

      ```
      cf login -a API-URL -u USERNAME -p PASSWORD -o system -s app-metrics-v2
      ```

      Where:

      + `API-URL` is your API endpoint.
      + `USERNAME` is your username.
      + `PASSWORD` is your password.

  1. Update the `HTTP_PROXY` or `HTTPS_PROXY` environment variable:

      ```
      cf set-env appmetrics HTTP_PROXY "http://PROXY-HOST:PROXY-PORT"
      ```

      or

      ```
      cf set-env appmetrics HTTPS_PROXY "https://PROXY-HOST:PROXY-PORT"
      ```

      Where:

      + `PROXY-HOST` is the hostname of your HTTP or HTTPS proxy.
      + `PROXY-PORT` is the port that your HTTP or HTTPS proxy is listening on.

The HTTP proxy environment variables must be uppercase.

For more information
    on setting system-wide environment variables, see [Environment Variable Groups](https://docs.cloudfoundry.org/devguide/deploy-apps/environment-variable.html#evgroups)
    in the Cloud Foundry Documentation.

## <a id='ConfigureFeatures'></a>Configure App Metrics Features (Optional)

To configure the settings for App Metrics components, including Log Store, follow these steps:
<ol>
<li>Click <strong>App Metrics</strong> tile on the Ops Manager Installation Dashboard.</li>
<li>Go to App Metrics Components Config pane.</li>
<li>Deactivate Logs Drawer on the App Metrics dashboard,and deselect the App Metrics Enable Logs check box (the default setting is activated).</li>
<li>Set App Metrics Logs Prune Threshold disk capacity percentage (the default setting is 80%). This is the disk percentage that Log Store starts to prune starting with the oldest logs.</li>
<li>Set the App Metrics Logs Prune Interval (the default setting is two minutes). This is the frequency the Log Store checks the disk capacity to make your pruning decision.</li>
</ol>

## <a id='ConfigureSyslog'> </a> Configure Syslog Forwarding (Optional)

App Metrics supports forwarding syslog to an external log management service. For example Papertrail, Inc., Splunk Technology, or another custom enterprise log sink. You might find the VM logs useful for debugging problems in the system.

To enable remote syslog forwarding for Healthwatch, do the following:

1. Click **App Metrics** tile on the Ops Manager Installation Dashboard.

2. Go to Syslog pane.

3. Select **Yes without encryption** or **Yes with TLS encryption** to activate syslog forwarding.
4. For External Syslog Host, enter the address of syslog server where you want logs sent. For example, [logs.example.com].

5. For External Syslog Port, enter the port of your syslog server. For example, [29279].
6. For External Syslog Protocol, select the protocol for sending the logs.
7. (TLS only) For External Syslog Permitted Peer, enter the fingerprint or name of the remote peer. For example, [*.example.com].
8. (TLS only) For External Syslog TLS CA Certificate, enter the CA certificate of the syslog destination.

## <a id='ConfigureMetricRegistrar'></a>Configure Metric Registrar for Spring Boot Metrics (Optional)

For Metric Registrar to accurately report Spring Metrics, the configuration for Metric Registrar must be updated with the VMware Tanzu Application Service for VMs (TAS for VMs) or Pivotal Application Service (PAS) tile.

To update the Metric Registrar configuration, do the following:
<ol>
<li>Click <strong>TAS for VMs</strong> or the <strong>PAS</strong> tile on the Ops Manager Installation Dashboard.</li>
<li>Go to Metric Registrar pane.</li>
<li>Update the Blocked tags list. Remove the `id` tag from the Blocked tags list.</li>
</ol>

## <a id='AppManagerLinkConfig'></a> Enable the App Metrics Link in Apps Manager (Optional)

Use this topic if **View in App Metrics** does not appear in Apps Manager and if App Metrics is deployed with one the following versions of TAS for VM or PAS:

+ Tas for VMs v3.0
+ TAS for VMs v2.10.x
+ TAS for VMs v2.9.x
+ PAS v2.8.4 or later
+ PAS v2.7.10 or later
+ PAS v2.6.16 or later

The **View in App Metrics** link might not appear in Apps Manager if your deployment has restrictive networking policies around your request proxy.

To resolve this issue and activate the App Metrics link in Apps Manager:

1. Log in to cf CLI and run:

    ```
    cf login -a API-URL -u USERNAME -p PASSWORD -o system -s system
    ```

    Where:

    + `API-URL` is your API endpoint.
    + `USERNAME` is your username.
    + `PASSWORD` is your password.

1. Update the `no_proxy` environment variable for the `search-server` app to include your system domain.

    ```
    cf set-env search-server no_proxy '*.SYSTEM-DOMAIN'
    ```

    where `SYSTEM-DOMAIN` is the system domain configured for your deployment.

    For example:
    <pre class="terminal">
    cf set-env search-server no_proxy '*.example.com'
    </pre>

1. Restage the `search-server` app.

    ```
    cf restage search-server
    ```
